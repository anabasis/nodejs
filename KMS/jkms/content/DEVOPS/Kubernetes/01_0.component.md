# Component

- `쿠버네티스`를 배포하면 `클러스터`를 얻는다.
- `쿠버네티스 클러스터`는 `컨테이너화`된 `애플리케이션`을 실행하는 `노드`라고 하는 `워커 머신`의 집합. `모든 클러스터는 최소 한 개의 워커 노드`를 가진다.

- `워커 노드`는 애플리케이션의 구성요소인 `파드(POD)`를 호스트
- `컨트롤 플레인`은 `워커 노드` 와 클러스터 내 파드를 관리
- 프로덕션 환경에서는 일반적으로 `컨트롤 플레인`이 여러 컴퓨터에 걸쳐 실행
- `클러스터`는 일반적으로 여러 노드를 실행하므로 내결함성과 고가용성이 제공된다.

![구성도](./images/components-of-kubernetes.png)

## Kubernetes Control Plane(컨트롤 플래인 컴포넌트)

- 클러스터에 대한 전반적인 결정(스케줄링)을 수행
- 클러스터 이벤트를 감지하고 반응(디플로이먼트의 replicas 필드에 대한 요구조건을 충족하지 않은 경우 새로운 파드POD를 구동)

### kube-apiserver

- API 서버는 쿠버네티스 API를 노출하는 쿠버네티스 컨트롤 플레인 컴포넌트
- 쿠버네티스 컨트롤 플레인의 프론트엔드
- kube-apiserver는 수평으로 확장되도록 디자인(더 많은 인스턴스를 배포해서 확장)
- 여러 kube-apiserver 인스턴스를 실행하고, 인스턴스간의 트래픽을 균형있게 조절

### etcd

- 모든 클러스터 데이터를 담는 쿠버네티스 뒷단의 저장소로 사용되는 일관성·고가용성 키-값 저장소
- 쿠버네티스 클러스터에서 etcd를 뒷단의 저장소로 사용한다면, 이 데이터를 백업하는 계획은 필수

### kube-scheduler

- 노드가 배정되지 않은 새로 생성된 파드를 감지하고, 실행할 노드를 선택하는 컨트롤 플레인 컴포넌트.
- 스케줄링 결정을 위해서 고려되는 요소는 리소스에 대한 개별 및 총체적 요구 사항, 하드웨어/소프트웨어/정책적 제약, 어피니티(affinity) 및 안티-어피니티(anti-affinity) 명세, 데이터 지역성, 워크로드-간 간섭, 데드라인을 포함

### kube-controller-manager

- 컨트롤러를 구동하는 마스터 상의 컴포넌트
  - 노드 컨트롤러: 노드가 다운되었을 때 통지와 대응에 관한 책임을 가진다.
  - 레플리케이션 컨트롤러: 시스템의 모든 레플리케이션 컨트롤러 오브젝트에 대해 알맞는 수의 파드들을 유지시켜 주는 책임을 가진다.
  - 엔드포인트 컨트롤러: 엔드포인트 오브젝트를 채운다(즉, 서비스와 파드를 연결시킨다.)
  - 서비스 어카운트 & 토큰 컨트롤러: 새로운 네임스페이스에 대한 기본 계정과 API 접근 토큰을 생성한다.

### cloud-controller-manager

- cloud-controller-manager는 바탕을 이루는 클라우드 제공사업자와 상호작용하는 컨트롤러를 작동
  - 노드 컨트롤러: 노드가 응답을 멈추고 나서 클라우드 상에서 삭제되어 졌는지 확정하기 위해 클라우드 제공사업자에게 확인하는 것
  - 라우트 컨트롤러: 바탕을 이루는 클라우드 인프라에 경로를 구성하는 것
  - 서비스 컨트롤러: 클라우드 제공사업자 로드밸런서를 생성, 업데이트 그리고 삭제하는 것
  - 볼륨 컨트롤러: 볼륨의 생성, 부착 그리고 마운트 하는 것과 볼륨을 조정하기 위해 클라우드 제공사업자와 상호작용하는 것

## Kubernetes Nodes(노드 컴포넌트)

### kubelet

- 클러스터의 각 노드에서 실행되는 에이전트. Kubelet은 파드에서 컨테이너가 확실하게 동작하도록 관리
- Kubelet은 쿠버네티스를 통해 생성되지 않는 컨테이너는 관리하지 않는다.

### kube-proxy

- kube-proxy는 클러스터의 각 노드에서 실행되는 네트워크 프록시로, 쿠버네티스의 서비스 개념의 구현부
- kube-proxy는 노드의 네트워크 규칙을 유지 관리한다. 이 네트워크 규칙이 내부 네트워크 세션이나 클러스터 바깥에서 파드로 네트워크 통신을 할 수 있도록 해준다
- kube-proxy는 운영 체제에 가용한 패킷 필터링 계층이 있는 경우, 이를 사용한다. 그렇지 않으면, kube-proxy는 트래픽 자체를 포워드(forward)한다.

### 컨테이너 런타임

- 컨테이너 실행을 담당하는 소프트웨어
- 쿠버네티스는 여러 컨테이너 런타임을 지원한다. 도커(Docker), containerd, CRI-O 그리고 Kubernetes CRI (컨테이너 런타임 인터페이스)를 구현한 모든 소프트웨어.

## Add-on(애드온)

- 버네티스 리소스(데몬셋, 디플로이먼트 등)를 이용하여 클러스터 기능을 구현
- 이들은 클러스터 단위의 기능을 제공하기 때문에 애드온에 대한 네임스페이스 리소스는 kube-system 네임스페이스에 속한다

### DNS

- 모든 쿠버네티스 클러스터는 클러스터 DNS를 갖추어야만 한다.
- 쿠버네티스 서비스를 위해 DNS 레코드를 제공해주는 DNS 서버

### 웹UI

- 대시보드는 쿠버네티스 클러스터를 위한 범용의 웹 기반 UI
- 사용자가 클러스터 자체뿐만 아니라, 클러스터에서 동작하는 애플리케이션에 대한 관리와 고장처리

### 컨테이너 리소스 모니터링

- 컨테이너 리소스 모니터링은 중앙 데이터베이스 내에 컨테이너들에 대한 포괄적인 시계열 매트릭스를 기록하고 그 데이터를 열람하기 위한 UI를 제공

### 클러스터-레벨 로깅

- [클러스터-레벨 로깅 메커니즘](https://kubernetes.io/docs/concepts/cluster-administration/logging/)은 검색/열람 인터페이스와 함께 중앙 로그 저장소에 컨테이너 로그를 저장하는 책임을 진다
