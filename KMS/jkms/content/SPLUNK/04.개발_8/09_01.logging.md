# Splunk Enterprise 용 앱 또는 애드온에 로그인
이 페이지에서
Splunk Enterprise 용 앱 또는 애드온에 로그인
로그에서 배울 수있는 것
일상적인 개발 활동에서 Splunk Enterprise, Splunk Cloud, Splunk Light 또는 Splunk Cloud Light (통칭하여 "Splunk 소프트웨어")를 사용하면 응용 프로그램의 품질을 개선하고 문제를 해결하는 데 걸리는 시간을 줄일 수 있습니다. Splunk 소프트웨어를 사용하면 로그 파일을 빠르고 쉽게 검색 할 수 있습니다. 전체 조직에서 로그의 가독성을 향상시키기 위해 약간의 코드 변경을 수행 할 수도 있습니다.

로그는 처리하기가 번거로울 수 있습니다. 실제 구조가 없으며 직접 만들지 않은 경우 그 내용을 알지 못할 수 있으며 파일과 로그 유형이 엄청나게 압도적 일 수 있습니다. 반면에 로그에는 분석 정보가 포함되어 있으며 문제를 찾는 데 도움이되며 IT 인프라, 사용자의 행동 및 잠재적 공격자를 식별 할 수 있습니다.

디버깅 목적으로 이미 로그를 사용하고있을 가능성이 있습니다. 그러나 로그 파일로 더 많은 것을 할 수 있습니다. 로그를 최대한 활용하는 방법과 올바르게 설정하는 방법을 알아 보려면 계속 읽으십시오. 결과는 그만한 가치가 있습니다.

로그에서 배울 수있는 것
로깅에는 두 가지 유형이 있습니다.

디버깅을위한 로깅. 응용 프로그램 개발자는 Splunk 소프트웨어를 사용하여 파일을 찾아서 탐색하지 않고 디버깅을 위해 자체 응용 프로그램 로그를 볼 수 있습니다. 경영진 및 다른 사람들은 디버깅 로그에서 정보를보고 시스템 안정성의 추세를 식별하고 문제를 분류하는 등의 작업에 관심이있을 수 있습니다.
시맨틱 로깅. 비즈니스 프로세스 상태 (웹 클릭, 금융 거래, 휴대폰 연결 및 끊어진 통화, 감사 내역 등)를 기록하는 이벤트 인 "의미 적"수준 이벤트를 기록 할 수도 있습니다.
일반적으로 IT 조직은 특정 기술, 기능, 사람 또는 부서의 사일로에 중점을 둔 시스템을 개발합니다. 개별적으로 이러한 사일로는 제한된 시야를 제공합니다. 그러나 모두 비표준, 비정형, 대용량이며 매일 밀리 초마다 증가하는 데이터를 생성합니다. 무엇을 로깅하든 모든 환경에는 활용할 IT 데이터 세트가 있습니다.

로그에는 고객 활동 및 동작, 제품 및 서비스 사용 및 트랜잭션에 대한 기록이 포함됩니다.
로그에는 응용 프로그램, 서버 및 네트워크 장치와 같은 IT 구성 요소에 대한 활동 기록이 포함됩니다.
종종 회사는 이러한 이벤트에 포함 된 데이터에 대한 통계 분석을 수행하기 위해 처음부터 자체 응용 프로그램을 작성해야합니다. 마찬가지로 회사는 손으로 대시 보드를 작성하여 기록 비교, 향후 예측, 성능 조정, 청구, 보안 등에 대한 분석을 표시합니다.

Splunk 소프트웨어는 데이터의 형식이나 스키마를 신경 쓰지 않습니다. 쿼리 및 검색은 임의적 일 수 있으며 데이터는 모든 텍스트 소스에서 제공 될 수 있습니다. Splunk 소프트웨어를 사용하면 응용 프로그램에서 생성 된 로그를 사용하여 특수한 소프트웨어를 구축하지 않고도 동일한 강력한 분석을 수행 할 수 있습니다. 데이터 디버깅 외에도 의미 데이터를 로깅하면 거의 모든 응용 프로그램을 크게 향상시킬 수 있습니다.

다음 스텁 코드는 구매 거래를 보여줍니다.

void submitPurchase(purchaseId)
{
    log.info("action=submitPurchaseStart, purchaseId=%d", purchaseId)
    // These calls throw an exception on error:

    submitToCreditCard(...)
    generateInvoice(...)
    generateFullfillmentOrder(...)
    log.info("action=submitPurchaseCompleted, purchaseId=%d", purchaseId)
}
이 의사 코드는 각 작업에 대한 구매 ID를 기록합니다. 위의 의사 코드에서 생성 된 두 가지 이벤트를 통해 구매 거래에 대해 많은 것을 배울 수 있습니다. 당신은 할 수 있습니다 :

시간, 일별 및 월별로 구매량을 그래프로 표시하십시오.
하루 중 요일과 시간에 구매하는 데 걸리는 시간을 알아보십시오.
지난 달에 비해 지금 구매하는 데 걸리는 시간을 알아보십시오.
시스템 속도가 느려지는지 확인하십시오.
실패한 구매 수를 확인하고 시간이 지남에 따라 이러한 실패를 그래프로 표시하십시오.
어떤 특정 구매에 실패했는지 확인하십시오.
이러한 각 항목은 Splunk 소프트웨어에서 전자 메일로 저장, 예약 및 공유 할 수있는 간단한 검색입니다. 또한 더 많은 데이터를 기록할수록 더 많은 데이터를 얻을 수있는 복잡한 솔루션을 설계 할 필요가 없습니다. 정말 간단합니다. RDBMS / SQL과 같이 복잡하고 융통성이없는 아키텍처 대신 Splunk 소프트웨어를 사용하십시오.

애플리케이션에서 최대의 이점을 얻으려면 올바른 방식으로 로깅을 설정하는 것이 중요합니다. 다른 사람들이 귀하의 로그를 보는 방법에 대해 생각하면서 시작하십시오. 이벤트가 로그와 분리 될 수 있습니다. 특정 이벤트는 IT 조직 내부 및 외부의 다양한 사람들에게 복사되어 전달 될 수 있습니다. 강력한 로깅 기술을 사용하지 않으면 의미있는 데이터를 잃어 로그에서 통찰력을 얻기가 더 어려워집니다. 디버깅 로그를 자신과 다른 사람에게보다 관련성 있고 강력하게 만드는 방법을 알아 보려면 로깅 모범 사례 를 참조하십시오 .

## Splunk Enterprise 용 앱 또는 애드온에서 모범 사례 로깅
이 페이지에서
Splunk Enterprise 용 앱 또는 애드온에서 모범 사례 로깅
이벤트 모범 사례
명확한 키-값 쌍 사용
인간이 읽을 수있는 이벤트 만들기
모든 이벤트에 타임 스탬프 사용
고유 식별자 (ID) 사용
텍스트 형식으로 로그인
개발자 친화적 인 형식 사용
디버깅 이벤트 이상의 것을 기록하십시오
카테고리 사용
소스를 식별
여러 줄 이벤트를 최소한으로 유지
운영 모범 사례
파일에 로컬로 기록
Splunk 포워더 사용
로테이션 정책 사용
모든 곳에서 이벤트 수집
이러한 모범 사례를 따르면 Splunk 소프트웨어가 로그를 최대한 활용할 수 있습니다.

이벤트 모범 사례
이러한 모범 사례는 이벤트를 구성하는 방식에 적용됩니다.

명확한 키-값 쌍 사용
Splunk 소프트웨어의 가장 강력한 기능 중 하나는 검색 할 때 이벤트에서 필드를 추출하여 구조화되지 않은 데이터로 구조를 생성하는 기능입니다. 필드 추출이 의도 한대로 작동하도록하려면 다음 문자열 구문을 사용하십시오 (공백과 쉼표를 사용하는 것이 좋습니다).

key1=value1, key2=value2, key3=value3 . . .
값에 공백이 있으면 따옴표로 묶습니다 (예 :) username="bob smith".

이것은 당신이 사용하는 것보다 조금 더 장황 할 수도 있지만 Splunk 소프트웨어의 자동 필드 추출은 크기 차이의 가치가 있습니다.

인간이 읽을 수있는 이벤트 만들기
이벤트 정보를 이해하기 쉽도록 조회해야하는 복잡한 인코딩을 사용하지 마십시오. 예를 들어, 로그가 이진 형식 인 경우 쉽게 읽을 수있는 (ASCII) 형식으로 쉽게 변환 할 수있는 도구를 제공하십시오. 해독하기 위해 임의의 코드가 필요한 형식을 사용하지 마십시오. 또한 동일한 파일에서 다른 형식을 사용하지 말고 개별 파일로 분리하십시오.

모든 이벤트에 타임 스탬프 사용
올바른 이벤트 순서를 이해하려면 정확한 시간이 중요합니다. 타임 스탬프는 디버깅, 분석 및 트랜잭션 도출에 중요합니다. Splunk 소프트웨어는 여러 가지 기술을 사용하여 이벤트를 포함하지 않는 이벤트를 자동으로 타임 스탬프하지만 가장 좋습니다.

가능한 가장 자세한 시간 단위를 사용하십시오.
타임 스탬프를 줄의 시작 부분에 넣으십시오. 타임 스탬프를 처음부터 멀수록 멀수록 타임 스탬프이며 다른 데이터가 아니라고 말하는 것이 더 어렵습니다.
네 자리 연도를 포함하십시오.
시간대, 바람직하게는 GMT / UTC 오프셋을 포함하십시오.
각 이벤트에서 시간은 마이크로 초 단위로 렌더링되어야합니다. 일정 시점에서 이벤트가 원본 소스 파일에서 분리 될 수 있으므로 이벤트에 대한 가장 정확한 데이터를 보유하는 것이 이상적입니다.
고유 식별자 (ID) 사용
트랜잭션 ID 및 사용자 ID와 같은 고유 식별자는 디버깅 할 때 매우 유용하며 분석을 수집 할 때 더욱 유용합니다. 고유 ID는 정확한 거래를 가리킬 수 있습니다. 그것들이 없으면 사용할 시간 범위 만있을 수 있습니다. 가능하면 여러 터치 포인트를 통해 이러한 ID를 가지고 모듈간에 이러한 ID의 형식을 변경하지 마십시오. 이렇게하면 시스템을 통해 트랜잭션을 추적하고 시스템, 네트워크 및 서비스에서 트랜잭션을 추적 할 수 있습니다.

텍스트 형식으로 로그인
Splunk 소프트웨어는 이진 데이터를 의미있게 검색하거나 분석 할 수 없으므로 이진 정보 기록을 피하십시오. 이진 로그는 압축되어 있기 때문에 선호되는 것처럼 보이지만이 데이터는 디코딩이 필요하며 세그먼트 화되지 않습니다. 이진 데이터를 기록해야하는 경우 텍스트 메타 데이터를 이벤트에 배치하면 여전히 검색 할 수 있습니다. 예를 들어, JPG 파일의 이진 데이터는 기록하지 말고 이미지 크기, 작성 도구, 사용자 이름, 카메라, GPS 위치 등은 기록하십시오.

개발자 친화적 인 형식 사용
개발자는 가능한 경우 HTTP / S를 통해 데이터 스트림을 수신하고 데이터를 쉽게 처리 할 수 ​​있도록 데이터를 구성하는 기능을 좋아합니다.

JSON (JavaScript Object Notation)과 같은 개발자 친화적 인 형식은 사람과 컴퓨터에서 읽을 수 있습니다. spath search 명령을 사용하면 구조화 된 데이터를 통한 검색이 훨씬 쉬워집니다 . 대부분의 프로그래밍 언어를 사용하면 구조화 된 데이터 형식을 브라우저없이 바로 서버에 쉽게 구문 분석 할 수 있습니다. 구조화 된 키-값 쌍을 사용하는 것은 특히 다음과 같이 계층 구조가 필요하거나 객체에 멤버가있는 경우에 좋습니다.

{ "sender" : "michael" "recipient": { "name" : "michael", "name" : "andrea", "name" : "itay" } subject:"I heart logs" }
여기서 JSON과 XML조차 집에 있습니다. 그러나 XML은 JSON만큼 깨끗한 것보다 사람이 읽기에 약간 더 시끄 럽습니다.

JSON 로그인에 대한 흥미로운 내용 은 Paul 's Journal에서이 항목을 읽으십시오 .

디버깅 이벤트 이상의 것을 기록하십시오
데이터에서 더 많은 것을 얻으려면 이벤트에 의미 적 의미를 두십시오. 감사 추적, 사용자의 작업, 트랜잭션, 타이밍 정보 등을 기록합니다. 집계, 차트 화 또는 추가 분석시 가치를 추가 할 수있는 모든 것을 기록하십시오. 즉, 비즈니스에 흥미로운 것을 기록하십시오.

카테고리 사용
이벤트를 분류하십시오. 예를 들어, 심각도 값을 사용하여 INFO, WARN, ERROR,와 DEBUG.

소스를 식별
클래스, 함수 또는 파일 이름과 같은 로그 이벤트 소스를 포함하십시오.

여러 줄 이벤트를 최소한으로 유지
여러 줄 이벤트는 많은 세그먼트를 생성하여 디스크 압축뿐만 아니라 인덱싱 및 검색 속도에 영향을 줄 수 있습니다. 여러 줄로 된 이벤트를 별도의 이벤트로 나누는 것을 고려하십시오.

운영 모범 사례
다음 운영 모범 사례는 로깅 방식에 적용됩니다.

파일에 로컬로 기록
로컬 파일에 로그인하면 로컬 파일이 제공되며 네트워크가 다운 되더라도 차단되지 않습니다.

Splunk 포워더 사용
Splunk 소프트웨어는 색인화 방법을 알고 있습니다. 로깅 데이터를 잃지 않도록 중단 된 부분을 따라 잡습니다.

로테이션 정책 사용
로그는 많은 공간을 차지할 수 있습니다. 준수 규정에 따라 수년간의 보관 스토리지를 유지해야하지만 프로덕션 시스템에서 파일 시스템을 채우고 싶지는 않습니다. 따라서 좋은 로테이션 전략을 설정하고 로그를 파기할지 백업할지 결정하십시오.

모든 곳에서 이벤트 수집
캡처하는 데이터가 많을수록 가시성이 높아 지므로 가능한 모든 데이터를 수집하십시오. 예를 들어, 가능한 경우 다음을 수집하십시오.

응용 프로그램 로그
데이터베이스 로그
네트워크 로그
구성 파일
성능 데이터 (iostat, vmstat, ps 등)
시간 구성 요소가있는 모든 것
Splunk 유니버설 포워더를 사용하면 파일에 저장된 로그 이벤트에 액세스하고 네트워크 포트를 통해 브로드 캐스트 할 수 있습니다. 그러나 파일이나 스트림으로 제한되지 않습니다. 응용 프로그램, 장치 또는 시스템에 묻혀있는 로그 데이터가있는 경우 전송, 프로토콜 또는 API를 통해 액세스 할 수있게하면 데이터에 액세스 할 수 있습니다. 다음은 로그 데이터를 해제하는 몇 가지 예입니다.

HTTP : 데이터에 쉽게 액세스하려면 로그 이벤트에 표준 HTTP GET 또는 HTTP POST 액세스를 제공하십시오. 각 요청에 대해 ID를 반환하면 새로운 이벤트를 쉽게 파악할 수 있습니다. 이 정보를 검색 할 수있는 서블릿의 예 는 Splunkbase에 POST POST 또는 GET 요청 매개 변수 로그를 참조 하십시오 .
대기열 : 액세스 가능한 대기열에 로그 이벤트를 게시합니다. 그런 다음 이러한 이벤트를 가져 와서 Splunk 소프트웨어 내에서 인덱싱 할 클라이언트를 만들 수 있습니다. 잘 알려진 큐잉 메커니즘의 예는 JMS 및 MQ Series입니다. 이에 대한 자세한 내용은 Splunk의 Dev 블로그에서 Nimish의 Splunk에 데이터 인덱싱을 원격으로 게시하기를 참조하십시오 .
멀티 캐스트 : 하트 비트를 수집하는 방법으로 멀티 캐스트 포트에서 이벤트를 수신하십시오. 일정 시간 동안 이벤트가 부족하면 인프라에 문제가 있음을 나타낼 수 있으며 Splunk 소프트웨어 내에서 경고를 설정하여 수정 조치를 취할 수 있습니다. 구현 예는 Splunk의 팁 및 트릭 블로그에서 멀티 캐스트로 전달 된 Nimish의 포스트 인덱싱 이벤트를 참조하십시오 .
웹 서비스 : 웹 서비스를 사용하여 로그 이벤트 또는 시계열 데이터를 노출합니다. 웹 서비스는 액세스 가능해야하며 WSDL (Web Services Description Language)을 제공하고 사용 방법을 보여주는 예제를 포함해야합니다. 이에 대한 자세한 내용은 Splunk의 Tips & Tricks 블로그에서 Nimish의 Splunk 게시물을 SOA 소비자로 참조하십시오 .
데이터베이스 : 데이터베이스에서 데이터를 가져 오려면 전송을 제공하고 신임 기반 API를 사용하십시오. 가장 간단한 예는 JDBC (Java Database Connectivity)와 같은 것을 사용하여 데이터에 액세스하는 관계형 데이터베이스 관리 시스템 (RDBMS) 내에 데이터를 보유하는 것입니다. 또한 JDBC 액세스를 위해 테이블 ​​이름과 최소 매개 변수가 필요합니다.

Splunk Enterprise 용 앱 또는 애드온의 로깅 예
이 페이지에서
Splunk Enterprise 용 앱 또는 애드온의 로깅 예
명확한 키-값 쌍 사용
다중 값 정보를 분류하십시오
제목을 키로 사용
여러 개의 고유 한 ID를 사용하여 이벤트 연결
이 항목에서는 Splunk 소프트웨어가 인덱스 할 이벤트를 생성 할 때 수행 할 작업과 수행 할 작업의 예를 제공합니다.

명확한 키-값 쌍 사용
하지 말아야 할 것의이 예에서, "오류"라는 용어는 너무 모호하며 키는 제공되지 않으므로 값에 지정되어야합니다.

나쁜:

Log.debug("error %d 454 - %s", userId, transId)
이 개선 된 버전에서는 키-값 쌍이 명확하게 제공되므로 이벤트를 구문 분석하기가 더 쉽습니다. 검색 "orderstatus=error"하면 원하는 이벤트가 정확하게 검색됩니다. 또한 로그 요청 completed=78%, aborted=21%, error=1%에 키워드 만있는 경우 수행 할 수없는 분배 요청 (예 :)과 같은 orderstatus를 사용하는 보고서에 대해 Splunk를 쿼리 할 수 ​​있습니다 "error".

좋은:

Log.debug("orderstatus=error, errorcode=454, user=%d, transactionid=%s", userId, transId)
다중 값 정보를 분류하십시오
이 다중 값 이벤트를 파싱하는 것은 어렵고 각 앱 값에 대한 데이터를 추가하는 것입니다.

나쁜:

<TS> phonenumber=333-444-4444, app=angrybirds,facebook
이 향상된 버전은 다중 값 정보를 별도의 이벤트로 나누므로 키-값 쌍이 더 명확합니다.

좋은:

<TS> phonenumber=333-444-4444, app=angrybirds, installdate=xx/xx/xx
<TS> phonenumber=333-444-4444, app=facebook, installdate=yy/yy/yy
제목을 키로 사용
다음 예와 같이 제목을 키로 사용할 수 있습니다. Splunk 소프트웨어는 열 머리글을 키로 해석하고 각 행을 값으로 해석 할 수 있습니다 (여러 행 이벤트 방지에 대한 규칙을 위반하더라도).

<TS>
USER PID %CPU %MEM VSZ RSS TT STAT STARTED TIME COMMAND
Root 41 21.9 1.7 3233968 143624 ?? Rs 7Jul11 48:09.67 /System/Library/foo
Rdas 790 4.5 0.4 4924432 32324 ?? S 8Jul11 9:00.57 /System/Library/baz
여러 개의 고유 한 ID를 사용하여 이벤트 연결
하나의 고유 식별자를 사용할 수없는 경우 한 이벤트에서 다른 이벤트로 전이 연결을 사용하십시오. 예를 들어 다음과 같은 세 가지 개별 이벤트가 있습니다.

Event A: transid=abcdef
Event B: transid=abcdef, otherid=qrstuv
Event C: otherid=qrstuv
이벤트 B의 두 ID 간 연결로 인해 이벤트 A를 이벤트 B 및 C와 연관시킬 수 있습니다.

## Splunk Enterprise 용 앱 또는 애드온에서 Splunk 확장 로깅
스크립트 된 입력, 조회, 사용자 지정 명령 또는 Splunk 소프트웨어와 유사한 확장을 개발할 때는 디버깅을위한 사용자 지정 로그 파일을 설정해야합니다. Splunk 소프트웨어는 sys.stdout정상적인 처리 를 위해 기록 하지만 디버깅 코드가 Splunk 소프트웨어 작업을 방해하지 않도록 로그 파일에 오류를 기록해야합니다. Splunk 소프트웨어는 Python logging모듈을 사용 하여 스크립트에 대한 포괄적 인 로깅 시스템을 제공합니다. 다음 디렉토리의 Splunk Enterprise 및 Splunk Light에서 로그를 생성하고 색인을 생성합니다.$SPLUNK_HOME/var/log/splunk

다음 예제는 사용자 정의 로그 (foo.log)를 작성하고 자동 회전을 설정하며 모든 운영 체제에 대한 올바른 파일 경로 형식을 자동으로 작성하는 로그 오브젝트를 정의하는 방법을 보여줍니다.

import sys, os
import logging, logging.handlers
import splunk
def setup_logging():
    logger = logging.getLogger('splunk.foo')    
    SPLUNK_HOME = os.environ['SPLUNK_HOME']
    
    LOGGING_DEFAULT_CONFIG_FILE = os.path.join(SPLUNK_HOME, 'etc', 'log.cfg')
    LOGGING_LOCAL_CONFIG_FILE = os.path.join(SPLUNK_HOME, 'etc', 'log-local.cfg')
    LOGGING_STANZA_NAME = 'python'
    LOGGING_FILE_NAME = "foo.log"
    BASE_LOG_PATH = os.path.join('var', 'log', 'splunk')
    LOGGING_FORMAT = "%(asctime)s %(levelname)-s\t%(module)s:%(lineno)d - %(message)s"
    splunk_log_handler = logging.handlers.RotatingFileHandler(os.path.join(SPLUNK_HOME, BASE_LOG_PATH, LOGGING_FILE_NAME), mode='a') 
    splunk_log_handler.setFormatter(logging.Formatter(LOGGING_FORMAT))
    logger.addHandler(splunk_log_handler)
    splunk.setupSplunkLogger(logger, LOGGING_DEFAULT_CONFIG_FILE, LOGGING_LOCAL_CONFIG_FILE, LOGGING_STANZA_NAME)
    return logger
logger = setup_logging()
logger.info("hello world!")
덜 표시
Splunk 소프트웨어는 로그 파일을 _internal인덱스 로 인덱싱하므로 다음과 같이 Splunk 소프트웨어 내에서 쉽게 액세스 할 수 있습니다.

index=_internal source="*/var/log/splunk/foo.log"

